version: '3'

dotenv: ['.env', '{{.HOME}}/.env']

vars:
  SPARK_JOBS_DIR: src.spark_jobs
  SPARK_SUBMIT: uv run -m


tasks:
  default:
    desc: Show available tasks
    cmds:
      - task --list
    silent: true

  set_up_project:
    desc: Setting up the project
    cmds:
      - uv sync
  ingest:
    desc: ğŸš€ Run ingestion step
    cmds:
      - echo "ğŸš€ Running ingestion step..."
      - "{{.SPARK_SUBMIT}} {{.SPARK_JOBS_DIR}}.execute_ingestion"

  match_facts:
    desc: âš½ Build match facts table
    cmds:
      - echo "âš½ Building match facts table..."
      - "{{.SPARK_SUBMIT}} {{.SPARK_JOBS_DIR}}.match_fact_table"

  standings:
    desc: ğŸ“Š Compute total standings
    cmds:
      - echo "ğŸ“Š Computing total standings..."
      - "{{.SPARK_SUBMIT}} {{.SPARK_JOBS_DIR}}.execute_total_standings"

  calculating_total_standings:
    desc: ğŸ Full pipeline! ingestion â†’ match facts â†’ standings
    cmds:
    - task: ingest
    - task: match_facts
    - task: standings
